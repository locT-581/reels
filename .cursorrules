# VortexStream Project Rules

## ðŸ“‹ Quy táº¯c Cáº­p nháº­t Tiáº¿n Ä‘á»™ (QUAN TRá»ŒNG)

### Sau khi hoÃ n thÃ nh Má»–I task:
1. **Báº®T BUá»˜C** cáº­p nháº­t checkbox trong `docs/IMPLEMENTATION_PLAN.md`:
   - Thay `- [ ]` thÃ nh `- [x]` cho task Ä‘Ã£ hoÃ n thÃ nh
   - Cáº­p nháº­t % tiáº¿n Ä‘á»™ cá»§a Phase tÆ°Æ¡ng á»©ng
   - Cáº­p nháº­t tráº¡ng thÃ¡i Phase (â¬œ â†’ ðŸ”„ â†’ âœ…)

### Sau khi hoÃ n thÃ nh Má»–I phase:
1. Cáº­p nháº­t báº£ng "Tá»•ng quan tiáº¿n Ä‘á»™" á»Ÿ Ä‘áº§u file:
   - Thay Ä‘á»•i tráº¡ng thÃ¡i: â¬œ ChÆ°a báº¯t Ä‘áº§u â†’ ðŸ”„ Äang thá»±c hiá»‡n â†’ âœ… HoÃ n thÃ nh
   - Cáº­p nháº­t % tiáº¿n Ä‘á»™
2. Cáº­p nháº­t "Tá»•ng tiáº¿n Ä‘á»™" overall
3. ThÃªm entry má»›i vÃ o báº£ng "Ghi chÃº cáº­p nháº­t"
4. Cáº­p nháº­t Milestones náº¿u applicable

### Format cáº­p nháº­t:
```markdown
## Phase X: [TÃªn Phase]
**Tiáº¿n Ä‘á»™ Phase X:** ðŸ”„ 12/24 tasks (50%)
```

### KÃ½ hiá»‡u tráº¡ng thÃ¡i:
- â¬œ ChÆ°a báº¯t Ä‘áº§u (0%)
- ðŸ”„ Äang thá»±c hiá»‡n (1-99%)
- âœ… HoÃ n thÃ nh (100%)
- â¸ï¸ Táº¡m dá»«ng
- âŒ Bá»‹ há»§y

---

## ðŸ—ï¸ Quy táº¯c Code

### Cáº¥u trÃºc Monorepo
- Táº¥t cáº£ packages náº±m trong `packages/`
- Apps (web, docs) náº±m trong `apps/`
- Sá»­ dá»¥ng pnpm workspace
- Import báº±ng package name: `@vortex/core`, `@vortex/player`, etc.

### TypeScript
- Strict mode báº¯t buá»™c
- KhÃ´ng sá»­ dá»¥ng `any` - dÃ¹ng `unknown` náº¿u cáº§n
- Export types rÃµ rÃ ng tá»« má»—i package
- Sá»­ dá»¥ng barrel exports (index.ts)

### Naming Conventions
- Components: PascalCase (`VideoPlayer.tsx`)
- Hooks: camelCase vá»›i prefix `use` (`usePlayer.ts`)
- Utils: camelCase (`formatCount.ts`)
- Types: PascalCase (`type VideoState`)
- Constants: SCREAMING_SNAKE_CASE (`MAX_BUFFER_SIZE`)

### File Structure trong Package
```
packages/[name]/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/     # React components
â”‚   â”œâ”€â”€ hooks/          # Custom hooks
â”‚   â”œâ”€â”€ utils/          # Utility functions
â”‚   â”œâ”€â”€ types/          # TypeScript types
â”‚   â”œâ”€â”€ constants/      # Constants
â”‚   â””â”€â”€ index.ts        # Barrel export
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ tsup.config.ts
```

---

## ðŸŽ¨ UI/UX Rules (tá»« BLUEPRINT.md)

### Design System "Vortex"
- **Ná»n chá»§ Ä‘áº¡o:** Pitch Black (#000000)
- **MÃ u nháº¥n:** Electric Violet (#8B5CF6)
- **Font:** Inter/Geist (San-serif)
- **Spacing:** Há»‡ thá»‘ng 8pt (8, 16, 24, 32...)
- **Bo gÃ³c:** 16px - 24px
- **Transition:** 300ms vá»›i easing `cubic-bezier(0.32, 0.72, 0, 1)`

### Video-centric Design
- Video chiáº¿m 100% diá»‡n tÃ­ch mÃ n hÃ¬nh
- CÃ¡c nÃºt tÆ°Æ¡ng tÃ¡c náº±m bÃªn pháº£i, xáº¿p dá»c
- Seek bar cá»±c máº£nh (2px), Ä‘áº­m khi cháº¡m (4px)
- KhÃ´ng sá»­ dá»¥ng ná»n tráº¯ng cho trang chá»©a video
- Icons: Outline â†’ Solid khi active

### Reachability First
- NÃºt báº¥m quan trá»ng trong vÃ¹ng bottom 1/3 mÃ n hÃ¬nh
- Tap area tá»‘i thiá»ƒu 48x48px
- Safe area insets cho notch/home indicator

---

## ðŸŽ¬ Video Player Rules

### HLS Configuration
```typescript
const hlsConfig = {
  maxBufferLength: 30,              // 30s
  maxMaxBufferLength: 60,           // 60s max
  maxBufferSize: 30 * 1000 * 1000,  // 30MB
  abrEwmaDefaultEstimate: 500000,   // 500kbps
  abrBandWidthUpFactor: 0.7,
  abrBandWidthFactor: 0.9,
  startLevel: -1,                   // Auto
  fragLoadingMaxRetry: 3,
}
```

### Video Activation Rules
- > 50% viewport â†’ Play
- < 30% viewport â†’ Pause + Reset
- Scroll velocity > 2000px/s â†’ Skip activation
- Scroll dá»«ng > 300ms â†’ Activate nearest

### Memory Management
- Max 5 videos trong DOM
- Max 3 decoded video frames
- Total memory < 150MB
- Aggressive cleanup khi low memory

---

## ðŸ“± Performance Budgets

### Bundle Size
| Package | Max Size (gzip) |
|---------|-----------------|
| @vortex/core | 5KB |
| @vortex/player | 70KB |
| @vortex/ui | 15KB |
| @vortex/gestures | 15KB |
| @vortex/feed | 8KB |
| @vortex/embed | 100KB |
| **Total** | **150KB** |

### Core Web Vitals
- LCP < 1.5s
- FID < 50ms
- CLS < 0.05
- INP < 150ms
- TTI < 2s

### Video Metrics
- Time to First Frame < 500ms
- Buffering Ratio < 1%
- Startup Failures < 0.5%
- Seek Latency < 200ms

---

## ðŸ§ª Testing Requirements

### Before PR
- [ ] Unit tests pass
- [ ] No TypeScript errors
- [ ] No ESLint errors
- [ ] Bundle size within budget
- [ ] Storybook stories updated (náº¿u cÃ³ UI changes)

### Before Release
- [ ] E2E tests pass
- [ ] Performance audit pass
- [ ] Cross-browser testing
- [ ] Accessibility check
- [ ] Memory leak check

---

## ðŸ“ Commit Convention

Format: `type(scope): message`

### Types
- `feat`: TÃ­nh nÄƒng má»›i
- `fix`: Bug fix
- `docs`: Documentation
- `style`: Code style (formatting)
- `refactor`: Refactoring
- `perf`: Performance improvement
- `test`: Tests
- `chore`: Build/tooling

### Scopes
- `core`: @vortex/core
- `player`: @vortex/player
- `ui`: @vortex/ui
- `gestures`: @vortex/gestures
- `feed`: @vortex/feed
- `embed`: @vortex/embed
- `web`: apps/web
- `docs`: apps/docs

### Examples
```
feat(player): add HLS quality selector
fix(feed): memory leak on scroll
docs(core): update API documentation
perf(player): optimize buffer management
```

---

## ðŸ”„ Workflow

### Khi báº¯t Ä‘áº§u task má»›i:
1. Äá»c task description trong IMPLEMENTATION_PLAN.md
2. Check dependencies (tasks trÆ°á»›c Ä‘Ã³)
3. Táº¡o branch: `feat/phase-X-task-name`
4. Implement
5. Test
6. Update IMPLEMENTATION_PLAN.md
7. Commit vá»›i convention
8. PR náº¿u cáº§n review

### Khi gáº·p blocker:
1. Mark task vá»›i â¸ï¸
2. Document blocker trong notes
3. Move to next task náº¿u cÃ³ thá»ƒ
4. Quay láº¡i khi blocker resolved

---

## ðŸš« Nhá»¯ng Ä‘iá»u KHÃ”NG Ä‘Æ°á»£c lÃ m

1. **KHÃ”NG** commit code chÆ°a test
2. **KHÃ”NG** bá» qua TypeScript errors
3. **KHÃ”NG** hardcode values - dÃ¹ng constants
4. **KHÃ”NG** dÃ¹ng inline styles - dÃ¹ng Tailwind classes
5. **KHÃ”NG** quÃªn cáº­p nháº­t IMPLEMENTATION_PLAN.md sau má»—i task
6. **KHÃ”NG** vÆ°á»£t quÃ¡ bundle size budget
7. **KHÃ”NG** dÃ¹ng third-party libraries khÃ´ng cáº§n thiáº¿t
8. **KHÃ”NG** bá» qua accessibility

---

## ðŸ“š Reference Documents

- [BLUEPRINT.md](./docs/BLUEPRINT.md) - Product specifications
- [TECHSTACK.md](./docs/TECHSTACK.md) - Technical decisions
- [IMPLEMENTATION_PLAN.md](./docs/IMPLEMENTATION_PLAN.md) - Implementation tracking

